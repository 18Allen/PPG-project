function [ap] = arousal_prob(RRI)
% Use ap to calculate
%%
% median RR. The article say +-90 seconds but this can wait for later .
RRI = 60*(1./RRI); % to bmp
median_RR = [];
for i = 46:length(RRI)-44
    median_RR = [median_RR, median(RRI(i-45:i+44))];
end
%%
% calculate the difference
RRI_diff = RRI(46:end-44) - median_RR;
% use the table 
ap = zeros([1,length(RRI_diff)-4]); % because it need to use a1~a5 so...
% (LL UL LR)x5 =15 columns from a1 to a5
% 1~10 class
table = [-900,-3.4,0.5361,-900,-2.8,0.2216,-900,-2.6,0.1469,-900,-2.7,0.1447,-900,-2.8,0.2302; ...
-3.3,-1.6,0.5456,-2.7,-1.1,0.2145,-2.5,-1.0,0.1508,-2.6,-1.0,0.0863,-2.7,-1.1,0.1071; ...
-1.5,-0.6,0.4153,-1.0,0.0,0.3117,-0.9,0.1,0.1610,-0.9,0.2,0.1212,-1.0,0.1,0.1475;...
-0.5,0.2,0.5675,0.1,1.0,0.3672,0.2,1.4,0.2395,0.3,1.5,0.2376,0.2,1.4,0.2053;...
0.3,1.1,0.5622,1.1,2.1,0.5299,1.5,2.7,0.5021,1.6,3.1,0.4836,1.5,3.0,0.3760;...
1.2,2.0,0.8710,2.2,3.5,1.2317,2.8,4.6,1.1652,3.2,5.3,1.2566,3.1,5.3,1.0231;...
2.1,3.3,1.0482,3.6,5.3,1.8880,4.7,7.1,3.1445,5.4,8.2,3.7838,5.4,8.8,3.6601;...
3.4,5.3,1.7931,5.4,7.8,3.6340,7.2,10.1,7.1163,8.3,11.8,11.9273,8.9,12.6,15.3023;...
5.4,8.8,4.0993,7.9,12.1,7.8734,10.2,14.7,20.4848,11.9,16.3,42.8125,12.7,17.4,38.5556;...
8.9,900,5.7642,12.2,900,16.3659,14.8,900,33.0952,16.4,900,57.7500,17.5,900,100.00];
%%
% get ap for each RRI
for i = 1:length(ap)
    PrP = 0.04;
    PrO = PrP/(1-PrP);
    for j = 1:5
        id = find(table(:,1+(j-1)*3) <= RRI_diff(i+(j-1)) & [table(2:end,1+(j-1)*3);900] > RRI_diff(i+(j-1)));       
        id = id(1);
        PrO = PrO*table(id,j*3);
    end
    ap(i)= PrO/(1+PrO);
end

end